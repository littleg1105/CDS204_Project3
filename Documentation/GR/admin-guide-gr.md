# Οδηγός Διαχειριστή

Αυτός ο οδηγός παρέχει λεπτομερείς οδηγίες για τους διαχειριστές της εφαρμογής Secure E-Shop, συμπεριλαμβανομένου του τρόπου ρύθμισης και διαχείρισης του περιβάλλοντος διαχείρισης με Αυθεντικοποίηση Δύο Παραγόντων.

## Επισκόπηση Περιβάλλοντος Διαχείρισης

Το περιβάλλον διαχείρισης Django για το Secure E-Shop παρέχει πρόσβαση σε:

- **Προϊόντα**: Προσθήκη, επεξεργασία και αφαίρεση προϊόντων από τον κατάλογο
- **Χρήστες**: Διαχείριση λογαριασμών χρηστών
- **Παραγγελίες**: Προβολή και διαχείριση παραγγελιών πελατών
- **Καλάθια Αγορών**: Προβολή τρεχόντων καλαθιών αγορών χρηστών

Το περιβάλλον διαχείρισης προστατεύεται από:
1. Αυθεντικοποίηση με όνομα χρήστη/κωδικό πρόσβασης
2. Αυθεντικοποίηση Δύο Παραγόντων (2FA) με χρήση Κωδικών Μιας Χρήσης Βάσει Χρόνου (TOTP)

## Πρόσβαση στο Περιβάλλον Διαχείρισης

Το περιβάλλον διαχείρισης είναι διαθέσιμο στη διεύθυνση:
- Τοπική ανάπτυξη: https://localhost:8000/admin/
- Παραγωγή: https://yourdomain.com/admin/

## Ρύθμιση Αυθεντικοποίησης Δύο Παραγόντων

### Αρχική Ρύθμιση OTP

Από τις 14 Μαΐου 2025, το περιβάλλον διαχείρισης απαιτεί Αυθεντικοποίηση Δύο Παραγόντων. Για να ρυθμίσετε το OTP για τον χρήστη διαχειριστή:

1. Εκτελέστε την ακόλουθη εντολή:
   ```bash
   python manage.py add_otp_device admin
   ```

2. Αυτό θα δημιουργήσει έναν κωδικό QR που θα αποθηκευτεί ως `admin_qrcode.png` στον ριζικό κατάλογο του έργου.

3. Σαρώστε αυτόν τον κωδικό QR με μια εφαρμογή αυθεντικοποίησης όπως:
   - Google Authenticator
   - Microsoft Authenticator
   - Authy

### Εφεδρικοί Κωδικοί

Η διαδικασία ρύθμισης δημιουργεί επίσης εφεδρικούς κωδικούς που μπορούν να χρησιμοποιηθούν εάν χάσετε την πρόσβαση στην εφαρμογή αυθεντικοποίησης. Αυτοί εμφανίζονται στο τερματικό όταν εκτελείτε την εντολή και θα πρέπει να αποθηκεύονται με ασφάλεια.

Παράδειγμα εφεδρικών κωδικών:
```
bi3b3vsj
5kovvnfg
setgr22o
nippcs7o
yjoxjqwt
```

## Διαδικασία Σύνδεσης με 2FA

1. Μεταβείτε στο περιβάλλον διαχείρισης στη διεύθυνση `https://localhost:8000/admin/` (ή στο URL παραγωγής σας)
2. Εισάγετε το όνομα χρήστη και τον κωδικό πρόσβασής σας
3. Θα ανακατευθυνθείτε σε μια δεύτερη σελίδα που ζητά τον κωδικό OTP σας
4. Ανοίξτε την εφαρμογή αυθεντικοποίησης και εισάγετε τον 6ψήφιο κωδικό που εμφανίζεται
5. Εάν δεν έχετε πρόσβαση στην εφαρμογή αυθεντικοποίησης, μπορείτε να χρησιμοποιήσετε έναν από τους εφεδρικούς κωδικούς

## Επαναφορά Ρύθμισης OTP

Εάν χρειάζεται να επαναφέρετε τη ρύθμιση OTP (π.χ., χάσατε το τηλέφωνο με την εφαρμογή αυθεντικοποίησης, χρησιμοποιήσατε όλους τους εφεδρικούς κωδικούς), εκτελέστε:

```bash
python manage.py add_otp_device admin
```

Αυτό θα δημιουργήσει έναν νέο κωδικό QR και εφεδρικούς κωδικούς, ακυρώνοντας την προηγούμενη ρύθμιση.

## Ρύθμιση OTP για Άλλους Χρήστες Διαχειριστές

Για να ρυθμίσετε το OTP για άλλους χρήστες διαχειριστές:

```bash
python manage.py add_otp_device <username>
```

Αυτό θα δημιουργήσει μια συσκευή OTP για τον καθορισμένο χρήστη και θα δημιουργήσει έναν κωδικό QR και εφεδρικούς κωδικούς.

## Διαχείριση Προϊόντων

### Προσθήκη Νέου Προϊόντος

1. Μεταβείτε στα **Products** στον πίνακα διαχείρισης
2. Κάντε κλικ στο **Add Product**
3. Συμπληρώστε τα στοιχεία του προϊόντος:
   - Όνομα
   - Περιγραφή
   - Τιμή
   - Εικόνα (προαιρετικά)
4. Κάντε κλικ στο **Save**

### Επεξεργασία Προϊόντων

1. Μεταβείτε στα **Products** στον πίνακα διαχείρισης
2. Κάντε κλικ στο προϊόν που θέλετε να επεξεργαστείτε
3. Ενημερώστε τα στοιχεία
4. Κάντε κλικ στο **Save**

### Μαζικές Ενέργειες

Μπορείτε να εκτελέσετε μαζικές ενέργειες σε προϊόντα:
1. Επιλέξτε πολλαπλά προϊόντα χρησιμοποιώντας τα πλαίσια ελέγχου
2. Επιλέξτε μια ενέργεια από το αναπτυσσόμενο μενού (π.χ., Delete selected products)
3. Κάντε κλικ στο **Go**

## Διαχείριση Παραγγελιών

### Προβολή Παραγγελιών

1. Μεταβείτε στα **Orders** στον πίνακα διαχείρισης
2. Κάντε κλικ σε μια παραγγελία για να δείτε λεπτομέρειες

### Ενημέρωση Κατάστασης Παραγγελίας

1. Ανοίξτε την παραγγελία
2. Αλλάξτε το πεδίο κατάστασης (π.χ., από "Processing" σε "Shipped")
3. Κάντε κλικ στο **Save**

## Διαχείριση Χρηστών

### Δημιουργία Χρηστών Διαχειριστών

Για να δημιουργήσετε έναν άλλο χρήστη διαχειριστή:

1. Μεταβείτε στους **Users** στον πίνακα διαχείρισης
2. Κάντε κλικ στο **Add User**
3. Συμπληρώστε το όνομα χρήστη και τον κωδικό πρόσβασης
4. Κάντε κλικ στο **Save**
5. Στην επόμενη οθόνη, επιλέξτε "Staff status" και "Superuser status"
6. Κάντε κλικ στο **Save**
7. Ρυθμίστε το OTP για τον νέο χρήστη διαχειριστή χρησιμοποιώντας την εντολή που αναφέρθηκε νωρίτερα

### Τροποποίηση Δικαιωμάτων Χρήστη

1. Μεταβείτε στους **Users** στον πίνακα διαχείρισης
2. Κάντε κλικ στον χρήστη
3. Ενημερώστε τα δικαιώματα όπως απαιτείται
4. Κάντε κλικ στο **Save**

## Παρακολούθηση Συστήματος

### Έλεγχος Προσπαθειών Σύνδεσης

Για την παρακολούθηση αποτυχημένων προσπαθειών σύνδεσης (πιθανές παραβιάσεις ασφαλείας):

1. Μεταβείτε στα **Access attempts** στον πίνακα διαχείρισης
2. Εξετάστε τη λίστα αποτυχημένων προσπαθειών, η οποία περιλαμβάνει:
   - Όνομα χρήστη
   - Διεύθυνση IP
   - User agent
   - Ώρα προσπάθειας

### Εξέταση Αρχείων Καταγραφής

Για πιο λεπτομερή παρακολούθηση, ελέγξτε τα αρχεία καταγραφής της εφαρμογής:

```bash
# Προβολή των τελευταίων 100 γραμμών του αρχείου καταγραφής εφαρμογής
tail -n 100 logs/app.log

# Παρακολούθηση του αρχείου καταγραφής σε πραγματικό χρόνο
tail -f logs/app.log
```

Στην παραγωγή, τα αρχεία καταγραφής μπορεί να βρίσκονται σε διαφορετική τοποθεσία ανάλογα με τη ρύθμισή σας.

## Δημιουργία και Επαναφορά Αντιγράφων Ασφαλείας

### Δημιουργία Αντιγράφου Ασφαλείας Βάσης Δεδομένων

Για να δημιουργήσετε ένα αντίγραφο ασφαλείας της βάσης δεδομένων:

```bash
# SQLite (Ανάπτυξη)
cp db.sqlite3 db.sqlite3.backup

# MySQL (Παραγωγή)
mysqldump -u username -p database_name > backup.sql
```

### Επαναφορά από Αντίγραφο Ασφαλείας

```bash
# SQLite (Ανάπτυξη)
cp db.sqlite3.backup db.sqlite3

# MySQL (Παραγωγή)
mysql -u username -p database_name < backup.sql
```

## Ρύθμιση Email

Το σύστημα αποστέλλει emails επιβεβαίωσης παραγγελίας. Για να ρυθμίσετε τις ρυθμίσεις email:

1. Ενημερώστε το αρχείο `.env` με τα διαπιστευτήρια email σας:
   ```
   EMAIL_HOST_USER=your-email@example.com
   EMAIL_HOST_PASSWORD=your-app-password
   ```

2. Για το Gmail, θα χρειαστεί να δημιουργήσετε ένα "App Password" στις ρυθμίσεις ασφαλείας του Google Account σας.

## Αντιμετώπιση Προβλημάτων

### Προβλήματα OTP

Εάν οι διαχειριστές αντιμετωπίζουν προβλήματα με το OTP:

1. Επαληθεύστε ότι η ώρα στη συσκευή της εφαρμογής αυθεντικοποίησης είναι σωστή
2. Εξετάστε το ενδεχόμενο επαναφοράς της συσκευής OTP με `python manage.py add_otp_device username`
3. Χρησιμοποιήστε εφεδρικούς κωδικούς εάν είναι διαθέσιμοι

### Κλειδώματα Σύνδεσης

Εάν ένας διαχειριστής κλειδωθεί λόγω πολλών αποτυχημένων προσπαθειών:

1. Ελέγξτε τις Προσπάθειες Πρόσβασης στον πίνακα διαχείρισης
2. Επαναφέρετε το κλείδωμα χρησιμοποιώντας το Django shell:
   ```bash
   python manage.py shell
   
   # Στο shell
   from axes.utils import reset
   reset()  # Επαναφορά όλων των κλειδωμάτων
   
   # Ή επαναφορά για συγκεκριμένο όνομα χρήστη
   reset(username='admin')
   ```

### Αρχεία Καταγραφής Σφαλμάτων

Ελέγχετε πάντα τα αρχεία καταγραφής εφαρμογής για λεπτομερείς πληροφορίες σφαλμάτων:
```bash
tail -n 100 logs/app.log
```

## Βέλτιστες Πρακτικές Ασφαλείας

1. **Αλλαγή Προεπιλεγμένων Διαπιστευτηρίων**: Αλλάζετε πάντα τα προεπιλεγμένα διαπιστευτήρια διαχειριστή
2. **Τακτικά Αντίγραφα Ασφαλείας**: Εκτελείτε τακτικά αντίγραφα ασφαλείας της βάσης δεδομένων
3. **Παρακολούθηση Προσπαθειών Σύνδεσης**: Ελέγχετε τακτικά για ύποπτες προσπάθειες σύνδεσης
4. **Τακτικές Ενημερώσεις**: Διατηρείτε το Django και όλες τις εξαρτήσεις ενημερωμένες
5. **Χρήση Ισχυρών Κωδικών Πρόσβασης**: Επιβάλετε πολιτική ισχυρών κωδικών πρόσβασης για όλους τους χρήστες διαχειριστές
6. **Περιορισμός Πρόσβασης Διαχειριστή**: Περιορίστε την πρόσβαση διαχειριστή μόνο στο απαραίτητο προσωπικό
7. **Αυθεντικοποίηση Δύο Παραγόντων**: Βεβαιωθείτε ότι όλοι οι χρήστες διαχειριστές έχουν ενεργοποιήσει το 2FA
